<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "";
    var thisFile = "README.md";
    var defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#package-alinex-mailman">Package: alinex-mailman</a>
      </div>

      <div class="heading h2">
        <a href="#install">Install</a>
      </div>

      <div class="heading h2">
        <a href="#usage">Usage</a>
      </div>

      <div class="heading h3">
        <a href="#run-as-a-service">Run as a service</a>
      </div>

      <div class="heading h3">
        <a href="#try-mode">Try mode</a>
      </div>

      <div class="heading h2">
        <a href="#configuration">Configuration</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-mailman" title="Fork me on GitHub"></a>
    <div class="docs markdown"><div class="pilwrap" id="package-alinex-mailman">
  <h1>
    <a href="#package-alinex-mailman" name="package-alinex-mailman" class="pilcrow"></a>
Package: alinex-mailman
  </h1>
</div>
<p><a href="https://travis-ci.org/alinex/node-mailman"><img src="https://travis-ci.org/alinex/node-mailman.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/r/alinex/node-mailman?branch=master"><img src="https://coveralls.io/repos/alinex/node-mailman/badge.png?branch=master" alt="Coverage Status"></a>
<a href="https://gemnasium.com/alinex/node-mailman"><img src="https://gemnasium.com/alinex/node-mailman.png" alt="Dependency Status"></a></p>
<p>Email based interface to control processes. This enables an user to send commands
through email. The incoming mails will be scanned automatically, checked and if
valid the command will be processed sending back a reply with the command's log.</p>
<ul>
<li>imap mail support</li>
<li>filter emails to access</li>
<li>authentication possible</li>
<li>remote control</li>
<li>complete logging</li>
</ul>
<blockquote>
<p>It is one of the modules of the <a href="http://alinex.github.io/code.html">Alinex Universe</a>
following the code standards defined in the <a href="http://alinex.github.io/develop">General Docs</a>.</p>
</blockquote>
<div class="pilwrap" id="install">
  <h2>
    <a href="#install" name="install" class="pilcrow"></a>
Install
  </h2>
</div>
<p><a href="https://www.npmjs.com/package/alinex-mailman"><img src="https://nodei.co/npm/alinex-mailman.png?downloads=true&amp;downloadRank=true&amp;stars=true" alt="NPM">
<img src="https://nodei.co/npm-dl/alinex-mailman.png?months=9&amp;height=3" alt="Downloads">
</a></p>
<p>Install the package globally using npm on a central server. From there all your
machines may be checked:</p>
<pre><code class="sh">sudo npm install -g alinex-mailman --production
</code></pre>
<p>After global installation you may directly call <code>mailman</code> from anywhere.</p>
<pre><code class="sh">mailman --help
</code></pre>
<p>Because this application works agentless, you don't have to do something special
on your clients but often some simple changes can make the reports more powerful.
If so you will get a hint in the report.</p>
<p>Always have a look at the latest <a href="Changelog.md.html">changes</a>.</p>
<div class="pilwrap" id="usage">
  <h2>
    <a href="#usage" name="usage" class="pilcrow"></a>
Usage
  </h2>
</div>
<p>After the mailman is configured you can start it once using:</p>
<pre><code>&gt; mailman
</code></pre>
<p>This will run the manager one time, check the emails run all required commands,
send the replies like configured and finish.</p>
<p>If the service is running you may also request the online help by sending
<code>subject: help me</code> to it's email address.</p>
<div class="pilwrap" id="run-as-a-service">
  <h3>
    <a href="#run-as-a-service" name="run-as-a-service" class="pilcrow"></a>
Run as a service
  </h3>
</div>
<p>To run the controller continuously use the <code>daemon</code> option and start it in the
background.</p>
<pre><code>&gt; mailman -d -C &gt; /var/log/mailman.log 2&gt;&amp;1 &amp;
</code></pre>
<p>This will run the process continuously in daemon mode checking every few minutes
for mails to be processed.</p>
<blockquote>
<p>For production use you may start it using <a href="http://pm2.keymetrics.io/">pm2</a>.
<code>pm2 start mailman -- --daemon</code></p>
</blockquote>
<div class="pilwrap" id="try-mode">
  <h3>
    <a href="#try-mode" name="try-mode" class="pilcrow"></a>
Try mode
  </h3>
</div>
<p>Mostly for testing you may use the try mode:</p>
<pre><code>&gt; mailman -t
</code></pre>
<p>That will run mailman normally but won't change the email so it can be used over
and over again. Alternatively you may mark the email as 'unread' to reenable it.</p>
<div class="pilwrap" id="configuration">
  <h2>
    <a href="#configuration" name="configuration" class="pilcrow"></a>
Configuration
  </h2>
</div>
<p>The base configuration for <code>/mailman</code> looks like:</p>
<pre><code class="yaml"><span class="hljs-comment"># Configuration for mailman</span>
<span class="hljs-comment"># =================================================================</span>

<span class="hljs-comment"># IMAP Server to check for mails</span>
<span class="hljs-attr">mailcheck:</span>
  <span class="hljs-comment"># Username for login</span>
<span class="hljs-attr">  user:</span> alexander.schilling@mycompany.de
  <span class="hljs-comment"># Password for login</span>
<span class="hljs-attr">  password:</span> mypass
  <span class="hljs-comment"># Host or IP address to connect to</span>
<span class="hljs-attr">  host:</span> mail.mycompany.de
  <span class="hljs-comment"># Connection port</span>
<span class="hljs-attr">  port:</span> <span class="hljs-number">143</span>
  <span class="hljs-comment"># Secure login, set to true to login through TLS</span>
<span class="hljs-attr">  tls:</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment"># TLS Upgrade decides when to upgrade to a secure session:</span>
  <span class="hljs-comment"># one of 'always', 'required', 'never'</span>
<span class="hljs-attr">  autotls:</span> never
  <span class="hljs-comment"># Connection timeout in milliseconds to wait to establish connection"</span>
<span class="hljs-attr">  connTimeout:</span> <span class="hljs-number">10</span>s
  <span class="hljs-comment"># Authentication timeout in milliseconds to wait to authenticate user"</span>
<span class="hljs-attr">  authTimeout:</span> <span class="hljs-number">5</span>s

<span class="hljs-comment"># Check interval to recheck for new emails in daemon mode</span>
<span class="hljs-attr">interval:</span> <span class="hljs-number">5</span>m
</code></pre>
<p>And then the commands under <code>/mailman/comand/</code> will look like:</p>
<pre><code class="yaml"><span class="hljs-comment"># Commands</span>
<span class="hljs-comment"># -------------------------------------------------------------------</span>
<span class="hljs-attr">command:</span>
  <span class="hljs-comment"># Object of possible commands to use</span>
<span class="hljs-attr">  date:</span>
    <span class="hljs-comment"># Title and description used for the mail response</span>
<span class="hljs-attr">    title:</span> <span class="hljs-string">"Get the Date"</span>
<span class="hljs-attr">    description:</span> <span class="hljs-string">"Get the date from the server."</span>
    <span class="hljs-comment"># Filter rules which define the emails to react on</span>
<span class="hljs-attr">    filter:</span>
      <span class="hljs-comment"># case-insensitive part of the subject</span>
<span class="hljs-attr">      subject:</span> <span class="hljs-string">'what time is it'</span>
      <span class="hljs-comment"># address or list of addresses, also as case-insensitive parts</span>
<span class="hljs-attr">      from:</span> <span class="hljs-string">'@mycompany.de'</span>
    <span class="hljs-comment"># Variables to support from body</span>
<span class="hljs-attr">    variables:</span>      
<span class="hljs-attr">      format:</span>
<span class="hljs-attr">        type:</span> <span class="hljs-string">'string'</span>
    <span class="hljs-comment"># Command to execute</span>
<span class="hljs-attr">    exec:</span>
      <span class="hljs-comment"># executional on command line</span>
<span class="hljs-attr">      cmd:</span> <span class="hljs-string">'date'</span>
      <span class="hljs-comment"># list of arguments</span>
<span class="hljs-attr">      args:</span> []
    <span class="hljs-comment"># response mail settings</span>
<span class="hljs-attr">    email:</span>
      <span class="hljs-comment"># use the template</span>
<span class="hljs-attr">      base:</span> default
</code></pre>
<p>Within the <code>args</code> you may use specific parameters given in mail body (but use them
all in lowercase). Also the following general variables are present:</p>
<ul>
<li><code>_mail</code> - the mail object
<ul>
<li><code>header</code> - some mail header fields like <code>from</code>, <code>cc</code>, <code>bcc</code>, <code>subject</code>, <code>messageId</code></li>
<li><code>body</code> - text and html body if available</li>
</ul>
</li>
<li><code>_json</code> - complete parameters</li>
</ul>
<p>So you may use the email address of the sender as <code>_mail.header.from</code> to give it
to your command.</p>
<p>The email templates are stored under <code>/email</code> will look like:</p>
<pre><code class="yaml"><span class="hljs-comment"># Email Templates</span>
<span class="hljs-comment"># -------------------------------------------------------------------</span>
<span class="hljs-attr">default:</span>
  <span class="hljs-comment"># specify how to connect to the server</span>
<span class="hljs-attr">  transport:</span> smtp://alexander.schilling%<span class="hljs-number">40</span>mycompany.de:&lt;&lt;&lt;env://PW_ALEX_COM&gt;&gt;&gt;@mail.mycompany.de
  <span class="hljs-comment"># sender address</span>
<span class="hljs-attr">  from:</span> alexander.schilling@mycompany.de
<span class="hljs-attr">  replyTo:</span> alexander.schilling@mycompany.de

  <span class="hljs-comment"># content</span>
<span class="hljs-attr">  locale:</span> de
<span class="hljs-attr">  subject:</span> <span class="hljs-string">&gt;
</span><span class="hljs-attr">    Re:</span> {{conf.title}}
<span class="hljs-attr">  body:</span> |+
  {{conf.title}}
  ==========================================================================

  {{conf.description}}

  Started on {{dateFormat date <span class="hljs-string">"LL"</span>}} from {{dateFormat process.start <span class="hljs-string">"LTS"</span>}} to {{dateFormat process.end <span class="hljs-string">"LTS"</span>}}

  PID {{process.host}}<span class="hljs-comment">#{{process.pid}}</span>

  {{<span class="hljs-comment">#if result.code}}</span>
  ::: alert
  **{{{result.error}}}** (Code {{result.code}})
  :::
  {{/if}}

  {{<span class="hljs-comment">#if result.stdout}}</span>
  Output of command was:

  ``` text
  {{{result.stdout}}}
</code></pre>
<p>{{/if}}</p>
<p>{{#if result.stderr}}
Error output from command was:</p>
<pre><code class="text">{{{result.stderr}}}
</code></pre>
<p>{{/if}}</p>
<pre><code>

License
-------------------------------------------------

Copyright 2016 Alexander Schilling

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

&gt;  &lt;http://www.apache.org/licenses/LICENSE-2.0&gt;

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>
</div>
  </div>
</body>
</html>
